# 現状整理

## 【AS IS】書籍注文フロー

### 1. 受信・一次確認（受付フェーズ）

まずは注文が正しく届いているか、内容が読み取れるかを確認します。

- 受信通知の確認: FAX機からの出力、またはPC・タブレットへの受信通知を確認する。
- 判読可否のチェック: 文字のかすれ、逆さま、白紙送信（裏返し送信）がないかを確認する。
- 必須項目の確認: 氏名（店名）、連絡先、希望納期、商品名、数量が記載されているかチェック。
- 例外対応
  - 判読不能な場合、即座に送信元へ電話し、再送を依頼する。
  - 注文書に不備（数量未記入など）があれば、作業を止めて確認の電話を入れる。

### 2. 在庫確認・受注登録（処理フェーズ）

注文を「受けることができるか」を判断し、システムや台帳へ記録します。

- 在庫・納期照会: 注文された商品をFAXの内容と照らし合わせ、在庫があるものについては注文を行う。
- 注文: 注文方法についてはものにより、webサイト経由で注文が必要なものもあればFaxで別途注文が必要なものもある
- 受注台帳への転記: FAXの内容を販売管理ソフトや手書きの受注台帳、Excel等に転記する。
- 注文請書の送付（必要に応じて）: 「承りました」という旨をFAXまたは電話で返信する。
- 例外対応
  - 在庫切れ・欠品の場合、代替品の提案や納期調整の連絡を行う。
  - 廃盤商品や価格改定があった場合、その旨を伝えて了承を得る。

### 3. 出荷・納品準備（作業フェーズ）

現場で商品を揃え、発送の準備をします。

- ピッキングリストの作成: FAXの原本（または転記したもの）を見ながら、商品を集める。
- 検品作業: **「FAX原本」「ピッキングした現物」**を突き合わせ、数量と種類に間違いがないかダブルチェックする。
- 梱包・伝票貼り付け: 商品を梱包し、実際に配達を行う。

### 4. 完了・保管（管理フェーズ）

発送後の事務処理と、後のトラブルを防ぐための証跡管理です。

- 請求処理: 売掛の場合は、納品書・請求書の発行処理を行う。
- 例外対応
  - キャンセル依頼が入った場合、出荷を止め、台帳の取消処理を行う。

## 【TO BE】書籍注文フロー（パターンA：下書き生成・確認モデル）

### 1. 受付・自動解析（システム自動処理：受付フェーズ）

システムが背後で情報を照合し、人間の判断を仰ぐための「トリアージ」を完了させます。

- 自動取込・OCR抽出: FAXを受信後、自動で画像化。ISBNと書名・著者名・数量をテキスト抽出。
- 多層的書誌情報照合
  - APIフォールバック: Primary APIを優先し、失敗時はSecondary APIへ自動切替。
  - API利用不能時の挙動: 外部APIがすべて利用不能な場合でも処理を停止せず、OCR抽出結果を「下書き」として提示。
  - 検知レベルの自動判定（トリアージ）
    - INFO：自動確定可能（人間確認は任意）
      - ISBN一致 ＋ タイトル一致（許容範囲内）。
    - WARN：人間確認必須（自動確定不可）
      - タイトル類似、著者不一致、候補が複数、またはAPI結果間で不一致がある場合。
    - ERROR：人間修正必須（確定不可）
      - ISBNチェックサムNG、APIヒット0件、必須項目欠落（数量なし等）。
- ルート自動判定: 出版社マスタ（人間が管理）を参照し、Web発注かFAX発注かを判定。

### 2. 内容確認・確定（人間：Web管理画面フェーズ）

人間は「INFO」をスルーし、「WARN/ERROR」の解決にリソースを集中させます。

- 三者比較・差分明示: [FAX原本] [OCR読取情報] [API検索正式情報] を並列表示。相違点はハイライト表示。
- ステータス別対応
  - INFO: 内容に違和感がなければ、そのまま（または一括）で受注確定。
    - WARN: ハイライト箇所（API間の齟齬など）を確認し、正しい情報を選択・承認して確定。
    - ERROR: 不足情報の追記やISBNの打ち直しを行い、エラーを解消した後に確定。
- 出版社マスタ管理: 新規出版社やルート変更を検知した際は、人間が管理画面からマスタを登録・修正し、次回以降の自動判定に即時反映。

### 3. 在庫確認・発注（人間：処理フェーズ）

確定済みのクリーンなデータを活用し、外部への注文を効率的に行います。

- 発注実行（手動補助）
  - Web発注: 管理画面のISBN・書名をワンクリックコピーし、指定サイトへ貼り付けて注文。
  - FAX発注: 管理画面の情報（出版社ルート）を参照し、従来通り発注。
- 請書送信: 確定データから生成された正式な回答文案を使い、お客様へ迅速に連絡。

### 4. 出荷・納品準備（人間：実作業フェーズ）

- ピッキングリスト作成: 確定データから発行された、正式書名・ISBN入りのリストで商品を確保。
- 検品作業: 「確定済データ（デジタル）」と「現物書籍（バーコード/奥付）」を目視で突き合わせ。
- 配送: 商品を梱包し、配達を実行。

### 5. 完了・保管（システム：自動処理）

- デジタルアーカイブ: FAX原本、検索ログ、修正履歴を紐付けて保存。
- マスタ学習: 人間によるマスタ修正（出版社名の表記ゆれ、ルート変更等）を次回以降の自動判定に反映。

## 【将来拡張：フェーズ2以降】

- 管理画面からのFAX直接送信ボタンの実装
- Web発注サイトへのブラウザ自動入力（RPA/LLM）
- カメラ/バーコードによるAI検品
- キャンセル時の在庫・請求の完全自動連動
